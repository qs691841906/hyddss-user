<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sinosoft.ddss.dao.OrderInfoMainMapper">
	<resultMap id="BaseResultMap" type="com.sinosoft.ddss.common.entity.Additional">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		<id column="order_main_id" property="orderMainId" />
		<result column="additional_id" property="additionalId" />
		<result column="user_name" property="userName" />
		<result column="user_unit" property="userUnit" />
		<result column="work_type" property="workType" />
		<result column="create_time" property="createTime" />
		<result column="order_name" property="orderName" />
		<result column="order_type" property="orderType" />
		<result column="priority" property="priority" />
		<result column="order_main_status" property="orderMainStatus" />
		<result column="distribution_type" property="distributionType" />
		<result column="predict_order_count" property="predictOrderCount" />
		<result column="real_order_count" property="realOrderCount" />
		<result column="batch_count" property="batchCount" />
		<result column="is_del" property="isDel" />
		<result column="cancel_status" property="cancelStatus" />
		<result column="update_time" property="updateTime" />
		<result column="order_main_desc" property="orderMainDesc" />
		<result column="audit_status" property="auditStatus" />
		<result column="auditor" property="auditor" />
		<result column="audit_time" property="auditTime" />
		<result column="audit_fail_reason" property="auditFailReason" />
		<result column="fail_reason" property="failReason" />
		<result column="distribution_status" property="distributionStatus" />
		<result column="satellite" property="satellite" />
		<result column="sensor" property="sensor" />
		<result column="start_time" property="startTime" />
		<result column="end_time" property="endTime" />
		<result column="in_product_level" property="inProductLevel" />
		<result column="out_product_level" property="outProductLevel" />
		<result column="urgent_level" property="urgentLevel" />
		<result column="AOI" property="aoi" />
		<result column="work_mode" property="workMode" />
		<result column="completion_time" property="completionTime" />
		<result column="data_start_time" property="dataStartTime" />
		<result column="data_end_time" property="dataEndTime" />
	</resultMap>
	<resultMap type="com.sinosoft.ddss.common.entity.query.OrderInfoQuery" id="OrderInfoQuery">
		<result column="order_status" property="orderStatus" />
		<result column="order_count" property="orderCount" />
	</resultMap>
	<sql id="Base_Column_List">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		order_main_id, additional_id, user_name, 
		to_char(create_time, 'yyyy/MM/dd HH24:mi:ss') create_time, 
		order_name, order_type, order_main_status,
		user_unit,work_type,priority, distribution_type, predict_order_count, 
		real_order_count, batch_count, is_del, cancel_status,
		distribution_status,
		to_char(update_time, 'yyyy/MM/dd HH24:mi:ss') update_time, 
		order_main_desc, audit_status, auditor,
		to_char(audit_time, 'yyyy/MM/dd HH24:mi:ss') audit_time,
		audit_fail_reason,fail_reason,
		additional_id, order_main_id, satellite, sensor,
		to_char(start_time, 'yyyy/MM/dd HH24:mi:ss') start_time,
		to_char(end_time, 'yyyy/MM/dd HH24:mi:ss') end_time, 
		in_product_level, out_product_level, urgent_level, AOI, work_mode,completion_time,
		to_char(data_start_time, 'yyyy/MM/dd HH24:mi:ss') data_start_time, 
		to_char(data_end_time, 'yyyy/MM/dd HH24:mi:ss') data_end_time 
	</sql>
	<select id="selectByPrimaryKey" parameterType="java.math.BigDecimal"
		resultMap="BaseResultMap">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		select
		<include refid="Base_Column_List" />
		from ddss_orderinfo_main
		where order_main_id =
		#{orderMainId}
	</select>
	<insert id="insertSelective" parameterType="com.sinosoft.ddss.common.entity.OrderInfoMain">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		insert into ddss_orderinfo_main
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="orderMainId != null">
				order_main_id,
			</if>
			<if test="additionalId != null">
				additional_id,
			</if>
			<if test="userName != null">
				user_name,
			</if>
			<if test="createTime != null">
				create_time,
			</if>
			<if test="orderName != null">
				order_name,
			</if>
			<if test="orderType != null">
				order_type,
			</if>
			<if test="orderMainStatus != null">
				order_main_status,
			</if>
			<if test="distributionType != null">
				distribution_type,
			</if>
			<if test="predictOrderCount != null">
				predict_order_count,
			</if>
			<if test="realOrderCount != null">
				real_order_count,
			</if>
			<if test="batchCount != null">
				batch_count,
			</if>
			<if test="isDel != null">
				is_del,
			</if>
			<if test="cancelStatus != null">
				cancel_status,
			</if>
			<if test="updateTime != null">
				update_time,
			</if>
			<if test="orderMainDesc != null">
				order_main_desc,
			</if>
			<if test="auditStatus != null">
				audit_status,
			</if>
			<if test="auditor != null">
				auditor,
			</if>
			<if test="auditTime != null">
				audit_time,
			</if>
			<if test="auditFailReason != null">
				audit_fail_reason,
			</if>
			<if test="failReason != null">
				fail_reason,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="orderMainId != null">
				#{orderMainId},
			</if>
			<if test="additionalId != null">
				#{additionalId},
			</if>
			<if test="userName != null">
				#{userName},
			</if>
			<if test="createTime != null">
				#{createTime,jdbcType=TIMESTAMP},
			</if>
			<if test="orderName != null">
				#{orderName},
			</if>
			<if test="orderType != null">
				#{orderType},
			</if>
			<if test="orderMainStatus != null">
				#{orderMainStatus},
			</if>
			<if test="distributionType != null">
				#{distributionType},
			</if>
			<if test="predictOrderCount != null">
				#{predictOrderCount},
			</if>
			<if test="realOrderCount != null">
				#{realOrderCount},
			</if>
			<if test="batchCount != null">
				#{batchCount},
			</if>
			<if test="isDel != null">
				#{isDel},
			</if>
			<if test="cancelStatus != null">
				#{cancelStatus},
			</if>
			<if test="updateTime != null">
				#{updateTime,jdbcType=TIMESTAMP},
			</if>
			<if test="orderMainDesc != null">
				#{orderMainDesc},
			</if>
			<if test="auditStatus != null">
				#{auditStatus},
			</if>
			<if test="auditor != null">
				#{auditor},
			</if>
			<if test="auditTime != null">
				#{auditTime,jdbcType=TIMESTAMP},
			</if>
			<if test="auditFailReason != null">
				#{auditFailReason},
			</if>
			<if test="failReason != null">
				#{failReason},
			</if>
		</trim>
	</insert>
	<update id="updateByPrimaryKeySelective" parameterType="com.sinosoft.ddss.common.entity.OrderInfoMain">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		update ddss_orderinfo_main
		<set>
			<if test="additionalId != null">
				additional_id = #{additionalId},
			</if>
			<if test="userName != null">
				user_name = #{userName},
			</if>
			<if test="createTime != null">
				create_time = #{createTime,jdbcType=TIMESTAMP},
			</if>
			<if test="orderName != null">
				order_name = #{orderName},
			</if>
			<if test="orderType != null">
				order_type = #{orderType},
			</if>
			<if test="orderMainStatus != null">
				order_main_status = #{orderMainStatus},
			</if>
			<if test="distributionType != null">
				distribution_type =
				#{distributionType},
			</if>
			<if test="predictOrderCount != null">
				predict_order_count =
				#{predictOrderCount},
			</if>
			<if test="realOrderCount != null">
				real_order_count = #{realOrderCount},
			</if>
			<if test="batchCount != null">
				batch_count = #{batchCount},
			</if>
			<if test="isDel != null">
				is_del = #{isDel},
			</if>
			<if test="cancelStatus != null">
				cancel_status = #{cancelStatus},
			</if>
			<if test="updateTime != null">
				update_time = #{updateTime,jdbcType=TIMESTAMP},
			</if>
			<if test="orderMainDesc != null">
				order_main_desc = #{orderMainDesc},
			</if>
			<if test="auditStatus != null">
				audit_status = #{auditStatus},
			</if>
			<if test="auditor != null">
				auditor = #{auditor},
			</if>
			<if test="auditTime != null">
				audit_time = #{auditTime,jdbcType=TIMESTAMP},
			</if>
			<if test="auditFailReason != null">
				audit_fail_reason = #{auditFailReason},
			</if>
			<if test="failReason != null">
				fail_reason = #{failReason},
			</if>
			<if test="dataStartTime != null">
				data_start_time = #{dataStartTime},
			</if>
			<if test="dataEndTime != null">
				data_end_time = #{dataEndTime},
			</if>
		</set>
		where order_main_id = #{orderMainId}
	</update>

	<select id="getOrderMainSeq" resultType="Long">
		select
		nextval('ddss_order_main_seq');
	</select>

	<!-- 查询订单数据 -->
	<select id="listOrder" resultMap="BaseResultMap"
		parameterType="com.sinosoft.ddss.common.entity.query.OrderInfoQuery">
		select
		<include refid="Base_Column_List" />
		from ddss_orderinfo_main
		<trim prefix="WHERE" prefixOverrides="AND | OR">
			<if test="userName != null and userName != ''">
				AND user_name = #{userName}
			</if>
			<if test="orderMainId != null and orderMainId != ''">
				AND order_main_id = #{orderMainId}
			</if>
			<choose>
				<when test="orderType != null and orderType != '' and orderType != 0">
					<if test="orderType != 8">
						AND order_type = #{orderType}
					</if>
					<if test="orderType == 8">
						AND (order_type = 5 OR order_type = 6)
					</if>
				</when>
				<otherwise>
					AND (order_type = 1 OR order_type = 2 OR order_type = 3 OR
					order_type = 4 OR order_type = 7)
				</otherwise>
			</choose>
			<if test="orderWarning == 1">
				and (create_time &lt; (SELECT current_timestamp - interval '${orderWaringTime} hour')
				and order_main_status != 5
				and order_main_status != 6
				and order_main_status != 7
				and (order_type = 1 or order_type = 3 or order_type = 7)
				and distribution_type = 1)
			</if>
			<if test="orderWarning == 2">
				and (
					(create_time &lt; (SELECT current_timestamp - interval '${orderWaringTime} hour')
					and (order_main_status = 5
					or order_main_status = 6
					or order_main_status = 7)
					or distribution_type != 1
					or (order_type != 1 and order_type != 3 and order_type != 7))
					or
					(create_time &gt; (SELECT current_timestamp - interval '${orderWaringTime} hour'))
				)
			</if>
			<if test="orderMainStatus != null and orderMainStatus != ''">
				AND order_main_status = #{orderMainStatus}
			</if>
			<if test="distributionType != null and distributionType != ''">
				AND distribution_type = #{distributionType}
			</if>
			<if test="auditStatus != null and auditStatus != ''">
				AND audit_status = #{auditStatus}
			</if>
			<if test="startTime != null and startTime != ''">
				AND to_timestamp(#{startTime}, 'yyyy-mm-dd HH24:mi:ss')
				&lt;=
				create_time
			</if>
			<if test="endTime != null and endTime != ''">
				AND to_timestamp(#{endTime}, 'yyyy-mm-dd HH24:mi:ss')
				&gt;=
				create_time
			</if>
			<if test="orderWarning != null and orderWarning != ''">
				AND create_time &lt; (SELECT current_timestamp - interval '${orderWaringTime} hour')
			</if>
			AND is_del = 1
		</trim>
		<choose>
			<when test="sortBy != null and sortBy != ''">
				<if test="sortType == 1">
					ORDER BY ${sortBy} ASC,order_main_id DESC
				</if>
				<if test="sortType != 1">
					ORDER BY ${sortBy} DESC,order_main_id DESC
				</if>
			</when>
			<otherwise>
				<if test="sortType == null or sortType == ''">
					ORDER BY create_time DESC
				</if>
				<if test="sortType == 1">
					ORDER BY create_time ASC
				</if>
				<if test="sortType == 2">
					ORDER BY create_time DESC
				</if>
			</otherwise>
		</choose>
		<if
			test="startNum != null and startNum >= 0 and pageSize != null and pageSize > 0">
			<![CDATA[ limit #{pageSize} offset #{startNum} ]]>
		</if>
	</select>
	
	<!-- 查询订单数据 -->
	<select id="QueryCallPolice" resultMap="BaseResultMap" parameterType="java.util.Map">
		SELECT order_main_id FROM ddss_orderinfo_main 
		WHERE 
			create_time &lt; (SELECT current_timestamp - interval '${orderWaringTime} hour')
			and order_main_status != 5
			and order_main_status != 6
			and order_main_status != 7
			and distribution_type = 1
			and (order_type = 1 or order_type = 3 or order_type = 7)
			and ${orderMainIds}
	</select>
	<!-- 查询订单数据 -->
	<select id="getCountByQuery" resultType="java.lang.Integer"
		parameterType="com.sinosoft.ddss.common.entity.query.OrderInfoQuery">
		select count(*) from ddss_orderinfo_main
		<trim prefix="WHERE" prefixOverrides="AND | OR">
			<if test="userName != null and userName != ''">
				AND user_name = #{userName}
			</if>
			<if test="orderMainId != null and orderMainId != ''">
				AND order_main_id = #{orderMainId}
			</if>
			<choose>
				<when test="orderType != null and orderType != '' and orderType != 0">
					<if test="orderType != 8">
						AND order_type = #{orderType}
					</if>
					<if test="orderType == 8">
						AND (order_type = 5 OR order_type = 6)
					</if>
				</when>
				<otherwise>
					AND (order_type = 1 OR order_type = 2 OR order_type = 3 OR
					order_type = 4 OR order_type = 7)
				</otherwise>
			</choose>
			<if test="orderWarning == 1">
				and (create_time &lt; (SELECT current_timestamp - interval '${orderWaringTime} hour')
				and order_main_status != 5
				and order_main_status != 6
				and order_main_status != 7
				and (order_type = 1 or order_type = 3 or order_type = 7)
				and distribution_type = 1)
			</if>
			<if test="orderWarning == 2">
				and (
					(create_time &lt; (SELECT current_timestamp - interval '${orderWaringTime} hour')
					and (order_main_status = 5
					or order_main_status = 6
					or order_main_status = 7)
					or distribution_type != 1
					or (order_type != 1 and order_type != 3 and order_type != 7))
					or
					(create_time &gt; (SELECT current_timestamp - interval '${orderWaringTime} hour'))
				)
			</if>
			<if test="orderMainStatus != null and orderMainStatus != ''">
				AND order_main_status = #{orderMainStatus}
			</if>
			<if test="distributionType != null and distributionType != ''">
				AND distribution_type = #{distributionType}
			</if>
			<if test="auditStatus != null and auditStatus != ''">
				AND audit_status = #{auditStatus}
			</if>
			<if test="startTime != null and startTime != ''">
				AND to_timestamp(#{startTime}, 'yyyy-mm-dd HH24:mi:ss')
				&lt;=
				create_time
			</if>
			<if test="endTime != null and endTime != ''">
				AND to_timestamp(#{endTime}, 'yyyy-mm-dd HH24:mi:ss')
				&gt;=
				create_time
			</if>
			AND is_del = 1
		</trim>
	</select>
	<!-- 审核 -->
	<update id="audit" parameterType="java.util.Map">
		update ddss_orderinfo_main
		<set>
			<if test="auditStatus != null and auditStatus != ''">
				audit_status = #{auditStatus},
			</if>
			<if test="auditFailReason != null and auditFailReason != ''">
				audit_fail_reason = #{auditFailReason},
			</if>
			<if test="auditor != null and auditor != ''">
				auditor = #{auditor},
			</if>
			audit_time = now()
		</set>
		where order_main_id in (${orderMainId})
	</update>
	<!-- 取消恢复(未审核的可以取消恢复) -->
	<update id="cancelOrder" parameterType="com.sinosoft.ddss.common.entity.OrderInfoMain">
		update ddss_orderinfo_main
		<set>
			<if test="cancelStatus != null">
				cancel_status = #{cancelStatus},
			</if>
			<if test="orderMainStatus != null and orderMainStatus!=''">
				order_main_status = #{orderMainStatus},
			</if>
		</set>
		where order_main_id = ${orderMainId} and audit_status = 1
	</update>
	<!-- 逻辑删除（订单状态为完成） -->
	<update id="delOrder" parameterType="java.lang.String">
		update ddss_orderinfo_main
		set is_del = 0
		where order_main_id in (${_parameter})
	</update>
	<insert id="saveOrderMain" parameterType="com.sinosoft.ddss.common.entity.Additional">
		insert into ddss_orderinfo_main
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="orderMainId != null and orderMainId!=''">
				order_main_id,
			</if>
			<if test="additionalId != null and additionalId!=''">
				additional_id,
			</if>
			<if test="userName != null and userName!=''">
				user_name,
			</if>
			<if test="orderName != null and orderName!=''">
				order_name,
			</if>
			<if test="orderType != null and orderType!=''">
				order_type,
			</if>
			<if test="orderMainStatus != null and orderMainStatus!=''">
				order_main_status,
			</if>
			<if test="distributionType != null and distributionType!=''">
				distribution_type,
			</if>
			<if test="predictOrderCount != null">
				predict_order_count,
			</if>
			<if test="realOrderCount != null">
				real_order_count,
			</if>
			<if test="batchCount != null and batchCount!=''">
				batch_count,
			</if>
			<if test="cancelStatus != null and cancelStatus!=''">
				cancel_status,
			</if>
			<if test="updateTime != null and updateTime!=''">
				update_time,
			</if>
			<if test="orderMainDesc != null and orderMainDesc!=''">
				order_main_desc,
			</if>
			<if test="auditStatus != null and auditStatus!=''">
				audit_status,
			</if>
			<if test="auditor != null and auditor!=''">
				auditor,
			</if>
			<if test="auditTime != null and auditTime!=''">
				audit_time,
			</if>
			<if test="auditFailReason != null and auditFailReason!=''">
				audit_fail_reason,
			</if>
			<if test="failReason != null and failReason!=''">
				fail_reason,
			</if>
			<if test="satellite != null and satellite !=''">
				satellite,
			</if>
			<if test="sensor != null and sensor !=''">
				sensor,
			</if>
			<if test="startTime != null and startTime !=''">
				start_time,
			</if>
			<if test="endTime != null and endTime !=''">
				end_time,
			</if>
			<if test="inProductLevel != null and inProductLevel !=''">
				in_product_level,
			</if>
			<if test="outProductLevel != null and outProductLevel !=''">
				out_product_level,
			</if>
			<if test="urgentLevel != null and urgentLevel !=''">
				urgent_level,
			</if>
			<if test="aoi != null and aoi !=''">
				aoi,
			</if>
			<if test="workMode != null and workMode !=''">
				work_mode,
			</if>
			<if test="isDel != null and isDel !=''">
				is_del,
			</if>
			<if test="userUnit != null and userUnit !=''">
				user_unit,
			</if>
			<if test="workType != null and workType !=''">
				work_type,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="orderMainId != null and orderMainId!=''">
				#{orderMainId},
			</if>
			<if test="additionalId != null and additionalId!=''">
				#{additionalId},
			</if>
			<if test="userName != null and userName!=''">
				#{userName},
			</if>
			<if test="orderName != null and orderName!=''">
				#{orderName},
			</if>
			<if test="orderType != null and orderType!=''">
				#{orderType},
			</if>
			<if test="orderMainStatus != null and orderMainStatus!=''">
				#{orderMainStatus},
			</if>
			<if test="distributionType != null and distributionType!=''">
				#{distributionType},
			</if>
			<if test="predictOrderCount != null">
				#{predictOrderCount},
			</if>
			<if test="realOrderCount != null">
				#{realOrderCount},
			</if>
			<if test="batchCount != null and batchCount!=''">
				#{batchCount},
			</if>
			<if test="cancelStatus != null and cancelStatus!=''">
				#{cancelStatus},
			</if>
			<if test="updateTime != null and updateTime!=''">
				to_timestamp(#{updateTime}, 'yyyy-mm-dd HH24:mi:ss'),
			</if>
			<if test="orderMainDesc != null and orderMainDesc!=''">
				#{orderMainDesc},
			</if>
			<if test="auditStatus != null and auditStatus!=''">
				#{auditStatus},
			</if>
			<if test="auditor != null and auditor!=''">
				#{auditor},
			</if>
			<if test="auditTime != null and auditTime!=''">
				to_timestamp(#{auditTime}, 'yyyy-mm-dd HH24:mi:ss'),
			</if>
			<if test="auditFailReason != null and auditFailReason!=''">
				#{auditFailReason},
			</if>
			<if test="failReason != null and failReason!=''">
				#{failReason},
			</if>
			<if test="satellite != null and satellite !=''">
				#{satellite},
			</if>
			<if test="sensor != null and sensor !=''">
				#{sensor},
			</if>
			<if test="startTime != null and startTime !=''">
				to_timestamp(#{startTime}, 'yyyy-mm-dd HH24:mi:ss'),
			</if>
			<if test="endTime != null and endTime !=''">
				to_timestamp(#{endTime}, 'yyyy-mm-dd HH24:mi:ss'),
			</if>
			<if test="inProductLevel != null and inProductLevel !=''">
				#{inProductLevel},
			</if>
			<if test="outProductLevel != null and outProductLevel !=''">
				#{outProductLevel},
			</if>
			<if test="urgentLevel != null and urgentLevel !=''">
				#{urgentLevel},
			</if>
			<if test="aoi != null and aoi !=''">
				#{aoi},
			</if>
			<if test="workMode != null and workMode !=''">
				#{workMode},
			</if>
			<if test="isDel != null and isDel !=''">
				#{isDel},
			</if>
			<if test="userUnit != null and userUnit !=''">
				#{userUnit},
			</if>
			<if test="workType != null and workType !=''">
				#{workType},
			</if>
		</trim>
	</insert>
	<!-- 查询in -->
	<select id="listOrderByOrderMainIds" resultMap="BaseResultMap"
		parameterType="java.lang.String">
		select
		<include refid="Base_Column_List" />
		from ddss_orderinfo_main
		where order_main_id in (${_parameter})
	</select>
	<!-- 查询where -->
	<select id="getOrderMainById" resultMap="BaseResultMap"
		parameterType="java.lang.Long">
		select
		<include refid="Base_Column_List" />
		from ddss_orderinfo_main
		where order_main_id = ${_parameter}
	</select>
	<update id="updateOrderMain" parameterType="com.sinosoft.ddss.common.entity.Additional">
		update ddss_orderinfo_main
		<set>
			update_time = now(),
			<if test="orderName != null and orderName != ''">
				order_name = #{orderName},
			</if>
			<if test="orderMainDesc != null and orderMainDesc != ''">
				order_main_desc = #{orderMainDesc},
			</if>
			<if test="distributionType != null and distributionType != ''">
				distribution_type =	#{distributionType},
			</if>
			<if test="satellite != null and satellite != ''">
				satellite = #{satellite},
			</if>
			<if test="sensor != null and sensor != ''">
				sensor = #{sensor},
			</if>
			<if test="startTime != null and startTime != ''">
				start_time = to_timestamp(#{startTime}, 'yyyy-mm-dd HH24:mi:ss'),
			</if>
			<if test="endTime != null and endTime != ''">
				end_time = to_timestamp(#{endTime}, 'yyyy-mm-dd HH24:mi:ss'),
			</if>
			<if test="aoi != null and aoi != ''">
				aoi = #{aoi},
			</if>
			<if test="outProductLevel != null and outProductLevel != ''">
				out_product_level = #{outProductLevel},
			</if>
		</set>
		where order_main_id = #{orderMainId}
	</update>
	<!-- 更新订单状态 -->
	<update id="updateOrderStatus" parameterType="java.util.Map">
		update ddss_orderinfo_main
		<set>
			<if test="orderStatus != null and orderStatus != ''">
				order_main_status = to_number(#{orderStatus}, '99999'),
			</if>
			<if test="failReason != null and failReason != ''">
				fail_reason = #{failReason},
			</if>
			<if test="auditor != null and auditor != ''">
				auditor = #{auditor},audit_time = now()
			</if>
		</set>
		where order_main_id in (${orderId})
	</update>
	<!--根据id查询语句(返回List<Map<String, Object>>)-->
	<select id="findOrderBySonOrderId" resultType="java.util.Map" parameterType="String">
		SELECT
			 DISTINCT
			 dom.order_main_id,
			 dom.user_name,
			 dom.order_name,
			 dom.order_type,
			 dom.order_main_status,
			 dom.distribution_type,
			 dom.order_main_desc
		FROM 
			ddss_orderinfo_main dom
		WHERE 
			dom.order_main_id IN (${_parameter})
	</select>
	
	<!-- 根据订单状态统计  -->
	<select id="statisticalOrderMainByStatus"
		parameterType="com.sinosoft.ddss.common.entity.query.OrderInfoQuery"
		resultMap="OrderInfoQuery">
		select
		order_main_status as order_status, count(1) as order_count
		from
		ddss_orderinfo_main
		<trim prefix="WHERE" prefixOverrides="AND | OR">
			<if test="userName != null and userName != ''">
				AND user_name = #{userName}
			</if>
			<if test="orderMainId != null and orderMainId != ''">
				AND order_main_id = #{orderMainId}
			</if>
			<choose>
				<when test="orderType != null and orderType != '' and orderType != 0">
					<if test="orderType != 8">
						AND order_type = #{orderType}
					</if>
					<if test="orderType == 8">
						AND (order_type = 5 OR order_type = 6)
					</if>
				</when>
				<otherwise>
					AND (order_type = 1 OR order_type = 2 OR order_type = 3 OR
					order_type = 4 OR order_type = 7)
				</otherwise>
			</choose>
			<if test="orderWarning == 1">
				and (create_time &lt; (SELECT current_timestamp - interval '${orderWaringTime} hour')
				and order_main_status != 5
				and order_main_status != 6
				and order_main_status != 7
				and (order_type = 1 or order_type = 3 or order_type = 7)
				and distribution_type = 1)
			</if>
			<if test="orderWarning == 2">
				and (
					(create_time &lt; (SELECT current_timestamp - interval '${orderWaringTime} hour')
					and (order_main_status = 5
					or order_main_status = 6
					or order_main_status = 7)
					or distribution_type != 1
					or (order_type != 1 and order_type != 3 and order_type != 7))
					or
					(create_time &gt; (SELECT current_timestamp - interval '${orderWaringTime} hour'))
				)
			</if>
			<if test="orderMainStatus != null and orderMainStatus != ''">
				AND order_main_status = #{orderMainStatus}
			</if>
			<if test="distributionType != null and distributionType != ''">
				AND distribution_type = #{distributionType}
			</if>
			<if test="auditStatus != null and auditStatus != ''">
				AND audit_status = #{auditStatus}
			</if>
			<if test="startTime != null and startTime != ''">
				AND to_timestamp(#{startTime}, 'yyyy-mm-dd HH24:mi:ss')
				&lt;=
				create_time
			</if>
			<if test="endTime != null and endTime != ''">
				AND to_timestamp(#{endTime}, 'yyyy-mm-dd HH24:mi:ss')
				&gt;=
				create_time
			</if>
			AND is_del = 1
		</trim>
		GROUP BY
		order_main_status
	</select>
	
	<!-- 根据订单状态统计  采集单-->
	<select id="statisticalCollectinfoByStatus"
		parameterType="com.sinosoft.ddss.common.entity.query.OrderInfoQuery"
		resultMap="OrderInfoQuery">
		select
		order_main_status as order_status, count(1) as order_count
		from
		ddss_orderinfo_main
		where (order_type = 5 or order_type = 6) AND is_del = 1 
		GROUP BY
		order_main_status
	</select>
	
	<!-- 根据订单状态统计  采集单-->
	<select id="sumDataSizeToday"
		resultType="java.lang.Double">
		SELECT
			sum(i.data_size) sum
		FROM
			ddss_orderinfo_main M,
			ddss_orderinfo i
		WHERE
			M .user_name = '${_parameter}'
		AND to_char(M .create_time, 'yyyy-MM-dd') = to_char(now(), 'yyyy-MM-dd')
		AND m.order_type = 1
		AND m.distribution_type = 1
	</select>
</mapper>